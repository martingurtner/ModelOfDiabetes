%\documentclass[14pt]{article}
\documentclass{article}
%\usepackage{extsizes}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[a4paper, inner=1.5cm, outer=2.5cm, top=2cm,
bottom=2cm, bindingoffset=1cm]{geometry}
\usepackage{graphicx}
\usepackage{subfigure}
\graphicspath{{img/}}  
\usepackage[section]{placeins}
\usepackage{afterpage}
\usepackage{titling}
\usepackage{siunitx}
\usepackage{epstopdf}
\usepackage{tikz}
\usepackage{bondgraph}
%\usepackage{cite}
\usepackage{booktabs}
\usepackage{color, colortbl}
\definecolor{Gray}{gray}{0.95}


\providecommand{\e}[1]{\ensuremath{\times 10^{#1}}}
\providecommand{\m}[1]{\ensuremath{\mathrm{#1}}}
\providecommand{\p}[1]{\ensuremath{\partial #1}}

\newcommand{\figWidth}{0.5\textwidth}
\newcommand{\subfigWidth}{0.45\textwidth}

\usepackage{todonotes}
\usetikzlibrary{shapes,arrows,decorations.markings}

\begin{document}
\title{Models for the detection of Diabetes}
\author{J\'achym Barv\'inek, Ji\v r\'i Figura, Martin Gurtner}

\maketitle

% ------------------------- Biological background  -------------------------
\section{Biological background}
We shall first give a short introduction to the problem by presenting the biological basis of it,
which is helpful in understanding the following mathematical formulations. 

Glucose is the main source of energy for our cells.
Humans obtain it either directly from food or as a result of metabolism of other saccharides. 
Glucose is needed by all cells in the body, but nerve cells are of critical imporance and there needs
to be glucose available for them at every instant. In accordance with theese needs, the glucose
metabolism evolved as follows:
After a period of not eating, a constant level of glucose in the bloodstream should be established,
some glucose is consumed by cells and this loss is balanced by glucose in the form of glycogen
released by liver. When some saccharides are ingested, they shall be metabolised into glucose
and as a result, it's concentration in the bloodstream increases. In this situation, the pancreas
releases the hormone insulin, which sends a signal to cells (other than nerve cells) that they should
now absorb more glucose from the bloodstream. At the same time, liver reacts to increased level of 
glucose in the bloodstream by absorbing it and converting it to glycogen for storage. Liver also 
decomposes the insulin. There are other hormones and factors which play a role in the metabolism
of glucose. Adrenaline, for example increases the amount of glucose in the bloodstream available
to cells. The concentration of this hormone is, however, difficult to measure precisely.
In the following text we thus assume insulin as the only significant hormone.

If the concentration of insulin in bloodstream is too high, then cells absorb most of the glucose 
and as a result, there may not be enough for the nerve cells, which may end up by coma or death.
If the level of insulin is too low, then cells cannot obtain the energy they need for normal functioning.
The later is the case which happens for people suffering by the disorder Diabetes Mellitus: Their bodies
create insufficient amounts of insulin.


% ------------------------- Bolie's diabetes model -------------------------
\section{Bolie's diabetes model}

Bolie's diabetes model is based on the following general assumptions, taken from~\cite{fulford_modelling_1997}:

\begin{enumerate}
	\item
	Insulin is being degraded by the liver.	
	\item
	A rise in the concentration of glucose in the bloodstream results in increased production of insulin by the pancreas.
	\item
	With increasing concentration of insulin, the glucose is more easily absorbed by the cells, i.e. it leaves the bloodstream more quickly.
	\item
	A rise in glucose concentration in the bloodstream results in increased glucose absorption by the liver.

\end{enumerate}


The model, described by eq.~\ref{eqbolie}, takes into account just two variables -- glucose $G$ and hormone insulin, denoted by $H$. Generally nonlinear functions on the right hand side of the equations follow directly from the assumptions above. The symbols with their corresponding meaning and units are summarized in Tab.~\ref{tabParam}. 

\begin{equation}
\label{eqbolie}
\begin{aligned}
V\frac{\m{d} H}{\m{d} t}&=-F_1(H)+F_2(G)+ x\\
V\frac{\m{d} G}{\m{d} t}&=-F_3(H,G)-F_4(H,G) + y 
\end{aligned}
\end{equation}

For changes around equilibrium $H_0$, $G_0$ we can rewrite the model to:

\begin{equation}
\label{eqbolieEquilibrium}
\begin{aligned}
V\frac{\m{d}h}{\m{d}t}&=-F_1(H_0+h)+F_2(G_0+g)+ x\\
V\frac{\m{d}g}{\m{d}t}&=-F_3(H_0+h,G_0+g)-F_4(H_0+h,G_0+g)+ y
\end{aligned}
\end{equation}

For small changes around the equilibrium it is possible to use linearized model. By Taylor expanding the eq.~\ref{eqbolieEquilibrium} we get:
\todo[inline]{Diskutovat odstraneni vstupu}
\begin{align*}
\frac{\m{d}h}{\m{d}t}&=-\underbrace{%
		\frac{1}{V}\frac{\p F_1(H_0)}{\p H}}_{\alpha}h+%
%
\underbrace{%
		\frac{1}{V}\frac{\p F_2(G_0)}{\p G}}_{\beta}g+\mathcal{O}(2) \\%		
%
\frac{\m{d}g}{\m{d}t}&=-\frac{1}{V}\frac{\p F_3(H_0, G_0)}{\p H}h- \frac{1}{V}\frac{\p F_3(H_0, G_0)}{\p G}g-\frac{1}{V}\frac{\p F_4(H_0, G_0)}{\p H}h-\frac{1}{V}\frac{\p F_4(H_0, G_0)}{\p G}g+\mathcal{O}(2)\\%
%
&=-\underbrace{%
\left(\frac{1}{V}\frac{\p F_3(H_0, G_0)}{\p H}+\frac{\p F_4(H_0, G_0)}{\p H}\right)}_{\gamma}h%
-\underbrace{%
\left(\frac{1}{V}\frac{\p F_3(H_0, G_0)}{\p G}+\frac{\p F_4(H_0, G_0)}{\p G}\right)}_{\delta} g+\mathcal{O}(2)\end{align*}

By omitting the second and higher order terms we get the following linear model:
\begin{equation}
\label{eqLinearized}
\begin{aligned}
\frac{\m{d}h}{\m{d}t}=-\alpha h + \beta g\\
\frac{\m{d}g}{\m{d}t}=-\gamma h - \delta g\\
\end{aligned}
\end{equation}

All of the constants $\alpha$, $\beta$, $\gamma$, $\delta$ are positive. Let's check that the signs correspond to Bolie's assumptions. If we put $g=0$ we can see from the first equation that the concentration of insulin decreases in time, which is in agreement with the first assumption.
On the other hand, if we put $h=0$ we can see that increase in $g$ leads to increase in $h$, which is in accordance with the second assumption.
Assumptions 3 and 4 say that rise in each of the variables results in   decrease of glucose concentration and the negative signs at both terms in the second equation reflect that.   

\begin{table}[!h]
\renewcommand{\arraystretch}{1.3}  
\centering
\begin{tabular}{lll}
\toprule
\textbf{Symbol}  & \textbf{Meaning} & \textbf{Dimension}\\
\midrule
$V$ & volume & \si{\liter}\\
\rowcolor{Gray}
$x$ & rate of insulin injection & units \si{\per\hour}\\

$y$ & rate of glucose injection & \si{\gram\per\hour}\\
\rowcolor{Gray}
$H$ & insulin concentration & units \si{\per\liter}\\
$H_0$ & insulin concentration equilibrium & units \si{\per\liter}\\
\rowcolor{Gray}
$h$ & insulin concentration changes & units \si{\per\liter}\\
$G$ & glucose concentration & \si{\gram\per\liter}\\
\rowcolor{Gray}
$G_0$ & glucose concentration equilibrium & \si{\gram\per\liter}\\
$g$ & glucose concentration changes & \si{\gram\per\liter}\\
\rowcolor{Gray}
$F_1(H)$ & rate of insulin destruction & units \si{\per\hour}\\
$F_2(G)$ & rate of insulin production & units \si{\per\hour}\\

\rowcolor{Gray}
$F_3(H,G)$ & rate of liver accumulation of glucose & \si{\gram\per\hour}\\
$F_4(H,G)$ & rate of tissue utilization of glucose & \si{\gram\per\hour}\\
\bottomrule
\end{tabular}
\caption{Diabetes model parameters.}
\label{tabParam}
\end{table}

% ------------------------- Linearized model solution -------------------------
\section{Linearized model solution}

We can reduce the linearized model from eq.~\ref{eqLinearized} to a 2\textsuperscript{nd} order by differentiating the first equation and substituting $\dot h$ with the second equation. $h$ is substituted with the expression for $h$ derived from the first equation. We get:

\begin{equation}
\ddot g+(\alpha+\delta)\dot g+(\beta \gamma+\delta \alpha)g=0,
\end{equation}
%where $S(t)$ is a nonhomogeneous term reflecting external glucose input to the bloodstream.  

The solutions are found by solving the characteristic polynomial

\begin{equation}
	\label{Eq:charEqn}
	\lambda^2+(\alpha+\delta)\lambda+(\beta\gamma+\delta\alpha)=0
\end{equation}

\begin{equation}
	\label{Eq:rootsOfCharEqn}
	\lambda_{1,2}=\frac{1}{2}\left(-(\alpha+\delta)\pm \sqrt{(\alpha-\delta)^2-4\beta\gamma}\right)
\end{equation}

Since both $(\alpha+\delta)$ and $(\beta\gamma+\delta\alpha)$ are positive, the solutions are always stable, going to zero with $t\rightarrow \infty$. If the discriminant is lower than zero then the solutions go to zero periodically, otherwise aperiodically.

\subsection*{General solution}
\begin{equation}
	\label{Eq:genSol}
	g(t) = A\,e^{\lambda_1 \, t} + B\,e^{\lambda_2 \, t}
\end{equation}
from initial conditions $g(t_0=0) = g_0$ and $\dot{g}(t_0=0) = -\delta \, g_0$
\todo{Jiri, dopis to nejak}
\begin{equation*}
	\label{Eq:genSolParams}
	A = g_0\,\frac{\delta+\lambda_2}{\lambda_2-\lambda_1}, \qquad B = g_0\,\frac{\delta+\lambda_1}{\lambda_1-\lambda_2}.
\end{equation*}

\todo[inline]{Pridat obecne reseni}


% ------------------------- Testing for diabetes -------------------------
\section{Testing for diabetes}
Now we will make use of the diabetes model. Probably the main purpose of developing such a model is to find a test which recognizes whereas a patient has a diabetes or not. We will discuss two tests developed in early sixties, where each of them has a very similar criterion but uses the above derived model in slightly different way.
% -----  Bolie's test -------
\subsection{Bolie's test}
Bolie~\cite{bolie1961coefficients} identified all parameters of the model~\eqref{eqLinearized} for a healthy person via three methods. Two of them were based on measurements of changing glucose concentration of rabbits and dogs and the identified parameters were then exptrapolated to humans. The third method utilized data from standard insulin and glucose tolerance tests. He assumed that the response of glucose concentration is critically dumped. Then he identified all parameters of the analytical response from measured data and recalculated them to parameters $\alpha$, $\beta$, $\gamma$ and $\delta$. The averaged parameters obtained by all three methods are summarized in Table~\ref{tabIdentParam}.

\begin{table}[!h]
\renewcommand{\arraystretch}{1.3}  
\centering
\begin{tabular}{lll}
\toprule
\textbf{Symbol}  & \textbf{Value} & \textbf{Dimension}\\
\midrule
$\alpha$ & $0.780$ & \si{\per\hour}\\
\rowcolor{Gray}
$\beta$ & $0.208$ & \si{unit\per\hour\per\gram}\\
$\gamma$ & $4.34$ & \si{\gram\per\hour\per unit}\\
\rowcolor{Gray}
$\delta$ & $2.92$ & \si{\per\hour}\\
\bottomrule
\end{tabular}
\caption{Identified parameters of Bolie's model}
\label{tabIdentParam}
\end{table}

By substitution of the identified parameters from Table~\ref{tabIdentParam} into equation~\eqref{Eq:rootsOfCharEqn} we get two distinct real roots
\begin{equation*}
	\lambda_1 = -1.36, \qquad 	\lambda_2 = -2.34.
\end{equation*}

Time response of glucose concentration can be easily obtained through substitution of the roots $\lambda_1$ and $\lambda_2$ into the equations~\eqref{Eq:genSolParams} and \eqref{Eq:genSol}.
\begin{equation}
	g(t) = g_0 \left( -0.59 e^{\lambda_1\,t} + 1.59 e^{\lambda_2\,t} \right)
\end{equation}

Now we can determine the time $t_\m{r}$ when the glucose concentration returns to its steady-state value. For this purpose we put $g(t)$ from equation~\eqref{Eq:genSol} and then it directly follows
\begin{equation*}
	0 = A\,e^{\lambda_1 \, t_\m{r}} + B\,e^{\lambda_2 \, t_\m{r}}		\quad\Rightarrow\quad
	e^{\lambda_1\,t_\m{r}} = -\frac{B}{A}\,e^{\lambda_2\,t_\m{r}} 	\quad\Rightarrow\quad
	t_\m{r} = \frac{1}{\lambda_1 - \lambda_2}\,\m{ln}\left(-\frac{B}{A}\right).
\end{equation*}
%\begin{align*}
%	0 &= g_0 \left( -0.59 e^{\lambda_1\,t_\m{r}} + 1.59 e^{\lambda_2\,t_\m{r}} \right) \\
%&\downarrow\\
%	0.59 e^{\lambda_1\,t_\m{r}} &= 1.59 e^{\lambda_2\,t_\m{r}} 	\\
%&\downarrow\\
%	t_\m{r} &= \frac{1}{\lambda_1 - \lambda_2}\,\m{ln}\left(\frac{1.59}{0.59}\right)
%\end{align*}


This can be further simplified by substitution of $A$ and $B$ from~\eqref{Eq:genSolParams} to
\begin{equation}
	t_\m{r} = \frac{1}{\lambda_1 - \lambda_2}\,\m{ln}\left(\frac{\lambda_1+\delta}{\lambda_2+\delta}\right).
\end{equation}

After substitution for all parameters we get time $t_\m{r}=1.01\,\si{\hour}$. This value corresponds to time when the glucose concentration returns to its original value after glucose ingestion for a healthy individual. Therefore the time $t_\m{r}$ can server as a threshold which indicates whether an individual has diabetes or not. The graph of $g(t)$ is displayed in Fig.~\ref{Fig:boliesTestGlucose}.

As we already know the general solution for $g(t)$, we can easily obtain the solution for $h(t)$ by rewriting of the first equation in~\eqref{eqLinearized} to
\begin{equation}
	h(t) = -\frac{1}{\gamma}\left( \dot{g}(t) + \delta\,g(t)\right).
\end{equation}

This gives us
\begin{equation}
	h(t) = -\frac{1}{\gamma}\left[   A(\lambda_1 + \delta)e^{\lambda_1\,t} + B(\lambda_2 + \delta)e^{\lambda_2\,t}  \right] = K\,g_0 \left(e^{\lambda_1\,t} - e^{\lambda_2\,t} \right),
\end{equation}
where $$K=\frac{(\lambda_1+\delta)(\lambda_2+\delta)}{\gamma\,(\lambda_2-\lambda_1)}.$$

Now we can calculate the time when insulin concentration reaches its maximum. We simply find a local maximum of $h(t)$ by solving equation $\dot{h}(t_\m{m})=0$ in very similar way as we did it for the glucose concentration.
\begin{equation*}
	\dot{h}(t_\m{m}) = K\,g_0 \left( \lambda_1\,e^{\lambda_1 \, t} - \lambda_2\,e^{\lambda_2 \, t} \right) = 0		\quad\Rightarrow\quad
	e^{\lambda_1\,t_\m{m}} = \frac{\lambda_2}{\lambda_1}\,e^{\lambda_2\,t_\m{m}} 	\quad\Rightarrow\quad
	t_\m{m} = \frac{1}{\lambda_1 - \lambda_2}\,\m{ln}\left(\frac{\lambda_2}{\lambda_1}\right).
\end{equation*}

The time $t_\m{m}$ for above identified parameters is $0.55\,\si{\hour}$. The function h(t) is depicted in Fig.~\ref{Fig:boliesTestInsulin}.

\begin{figure}[h!t!]
	\begin{center}
	\subfigure[Glucose concentration]{
		\includegraphics[width=\subfigWidth]{figs/boliesTestGlucose}
		\label{Fig:boliesTestGlucose}
	}
	\,
	\subfigure[Insulin concentration]{
		\includegraphics[width=\subfigWidth]{figs/boliesTestInsulin}	     
		\label{Fig:boliesTestInsulin}
	}
	\end{center}
	\caption{Time responses of glucose and insulin concentration after glucose ingestion}
\end{figure}

% -----  Ackermann's diabetes test -------
\subsection{Ackermann's diabetes test}

predpoklada kmitave reseni
\todo[inline]{opsat par rovnic ze strany 105/106}
\todo[inline]{vyresit ten stejny priklad jako vyse}


\bibliographystyle{IEEEtran}
\bibliography{DiabetesBibliography}

\end{document}
